<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Administrador Star | StarClutch</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="../campanas-styles-v2.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="admin-body">

  <nav class="sc-navbar">
    <div class="navbar-container">
      <div class="nav-brand">
        <img src="../img/Logo SC.svg" alt="Logo StarClutch">
        <span class="divider">|</span>
        <h1>Administrador Star</h1>
      </div>
      <ul class="nav-menu-horizontal">
        <li><a href="#flotas" class="active">Flotas del cliente</a></li>
        <li><a href="#repuestos">Lista de repuestos</a></li>
        <li><a href="#ofertas">Ofertas exclusivas</a></li>
        <li><a href="#cuenta">Estado de cuenta</a></li>
        <li><a href="#compras">Mis compras</a></li>
      </ul>
     <div class="nav-user">
        <button class="btn-text">
          <span class="icon-right"><img src="../img/Usuario.svg" alt="Usuario"></span>
          Hola, <strong>Admin</strong>
        </button>
        
        <button class="btn-text btn-logout" onclick="cerrarSesion()">
            Cerrar sesi√≥n <img src="../img/Cerrar sesi√≥n.svg" alt="Salir" style="margin-left:5px;">
        </button>
      </div>
  </nav>

  <main class="admin-container">

<section class="client-bar-section">
    <!-- BLOQUE 1: Gestionando a + Crear usuario -->
    <div style="display: flex; align-items: center; gap: 20px; flex-shrink: 0;">
        <div style="display: flex; align-items: center; gap: 12px;">
            <label for="client-select" style="white-space: nowrap;">Gestionando a:</label>
            <div class="sc-select-wrapper">
              <select id="client-select" class="sc-input-select">
                <option value="" disabled selected>Cargando clientes...</option>
              </select>
            </div>
        </div>
        
        <button class="btn-primary" onclick="abrirModalCrearUsuario()" style="white-space: nowrap; flex-shrink: 0;">
            <span style="font-size: 18px; margin-right: 5px;">+</span> Crear nuevo usuario
        </button>
    </div>
    
    <!-- BLOQUE 2: Botones 2x2 (derecha) -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; flex-shrink: 0;">
        <button class="btn-secondary" onclick="abrirModalAgregarModeloVehiculo()" style="white-space: nowrap; font-size: 13px; padding: 6px 12px;">
            <span style="font-size: 14px; margin-right: 4px;">+</span> Agregar modelo veh√≠culo
        </button>
        <button class="btn-secondary" onclick="abrirModalVerMarcasModelos()" style="white-space: nowrap; font-size: 13px; padding: 6px 12px;">
            <img src="../img/Ocultar contrase√±a.svg" alt="Ver" style="width: 14px; height: 14px; margin-right: 4px; filter: invert(22%) sepia(97%) saturate(3042%) hue-rotate(345deg) brightness(85%) contrast(95%);"> Ver marcas/modelos
        </button>
        <button class="btn-secondary" onclick="abrirModalAgregarMarcaProducto()" style="white-space: nowrap; font-size: 13px; padding: 6px 12px;">
            <span style="font-size: 14px; margin-right: 4px;">+</span> Agregar marca producto
        </button>
        <button class="btn-secondary" onclick="abrirModalVerMarcasProductos()" style="white-space: nowrap; font-size: 13px; padding: 6px 12px;">
            <img src="../img/Ocultar contrase√±a.svg" alt="Ver" style="width: 14px; height: 14px; margin-right: 4px; filter: invert(22%) sepia(97%) saturate(3042%) hue-rotate(345deg) brightness(85%) contrast(95%);"> Ver marcas productos
        </button>
        <button class="btn-secondary" onclick="abrirModalCrucesVehiculos()" style="white-space: nowrap; font-size: 13px; padding: 6px 12px;">
            <span style="font-size: 14px; margin-right: 4px;">+</span> Cruces de veh√≠culos
        </button>
        <button class="btn-secondary" onclick="abrirModalVerCrucesSistema()" style="white-space: nowrap; font-size: 13px; padding: 6px 12px;">
            <img src="../img/Ocultar contrase√±a.svg" alt="Ver" style="width: 14px; height: 14px; margin-right: 4px; filter: invert(22%) sepia(97%) saturate(3042%) hue-rotate(345deg) brightness(85%) contrast(95%);"> Ver cruces en el sistema
        </button>
        <button class="btn-secondary" onclick="abrirModalAgregarProductoBD()" style="white-space: nowrap; font-size: 13px; padding: 6px 12px;">
            <span style="font-size: 14px; margin-right: 4px;">+</span> Agregar producto BD
        </button>
        <button class="btn-secondary" onclick="abrirModalVerProductosGuardados()" style="white-space: nowrap; font-size: 13px; padding: 6px 12px;">
            <img src="../img/Ocultar contrase√±a.svg" alt="Ver" style="width: 14px; height: 14px; margin-right: 4px; filter: invert(22%) sepia(97%) saturate(3042%) hue-rotate(345deg) brightness(85%) contrast(95%);"> Ver productos guardados
        </button>
    </div>
</section>
    <section class="admin-section">
      <h2 class="section-title">Informaci√≥n del Cliente</h2>
      <div class="user-info-card">
        
        <div class="info-item">
          <span class="info-label">Nombre Empresa</span>
          <div class="info-value-row" id="info-nombre">
            <strong id="info-nombre-text">-</strong>
            <button class="btn-icon-edit" onclick="editarCampoCliente('nombre')"><img src="../img/Editar flota.svg" alt="Editar"></button>
          </div>
        </div>

        <div class="info-item">
          <span class="info-label">Usuario (ID de acceso)</span>
          <div class="info-value-row" id="info-id">
            <strong id="info-id-text">-</strong>
          </div>
        </div>

        <div class="info-item">
          <span class="info-label">Correo electr√≥nico</span>
          <div class="info-value-row" id="info-email">
            <strong id="info-email-text">-</strong>
            <button class="btn-icon-edit" onclick="editarCampoCliente('email')"><img src="../img/Editar flota.svg" alt="Editar"></button>
          </div>
        </div>

        <div class="info-item">
          <span class="info-label">Contrase√±a</span>
          <div class="info-value-row" id="info-password">
            <strong id="info-password-text">-</strong>
            <button class="btn-icon-edit" onclick="editarCampoCliente('password')"><img src="../img/Editar flota.svg" alt="Editar"></button>
          </div>
        </div>

        <div class="info-item">
          <span class="info-label">Direcci√≥n de env√≠o</span>
          <div class="info-value-row" id="info-direccion">
            <strong id="info-direccion-text">-</strong>
            <button class="btn-icon-edit" onclick="editarCampoCliente('direccion')"><img src="../img/Editar flota.svg" alt="Editar"></button>
          </div>
        </div>

        <div class="info-item">
          <span class="info-label">Contacto telef√≥nico</span>
          <div class="info-value-row" id="info-telefono">
            <strong id="info-telefono-text">-</strong>
            <button class="btn-icon-edit" onclick="editarCampoCliente('telefono')"><img src="../img/Editar flota.svg" alt="Editar"></button>
          </div>
        </div>

      </div>
      
      <div style="margin-top: 20px; text-align: right;">
        <button class="btn-primary" onclick="eliminarCuentaCliente()" style="background: #BF1823; border-color: #BF1823; display: inline-flex; align-items: center; gap: 8px;">
          <img src="../img/Deleteblanco.svg" alt="Eliminar" style="width: 16px; height: 16px;"> Eliminar cuenta
        </button>
      </div>
    </section>

  <section id="flotas" class="admin-section">
  <div class="section-header-row">
    <h2 class="section-title">Flotas del cliente</h2>
    <div style="display: flex; gap: 12px;">
      <button class="btn-primary" onclick="abrirModalSeleccionCargaFlota()">
        <span style="font-size: 18px; margin-right: 5px;">+</span> Nueva flota cliente
      </button>
      <button class="btn-secondary" onclick="abrirModalSeleccionAgregarVehiculo()" id="btn-agregar-vehiculo-flota" style="display: none;">
        <span style="font-size: 18px; margin-right: 5px;">+</span> Agregar veh√≠culo a la flota
      </button>
    </div>
  </div>
  
  <div class="admin-toolbar">
    <div style="display: flex; gap: 12px; align-items: center;">
      <div class="sc-select-wrapper" style="width: 280px;">
        <select id="admin-flota-select" class="sc-input-select">
          <option value="" disabled selected>Primero seleccione un cliente arriba</option>
        </select>
      </div>
      <button class="btn-primary" onclick="adminEliminarFlota()" style="display: flex; align-items: center; gap: 8px;">
        <img src="../img/Deleteblanco.svg" alt="Eliminar" style="width: 18px; height: 18px;">
        Eliminar flota
      </button>
    </div>
    
    <div class="admin-actions" style="display: flex; gap: 12px; align-items: center;">
      <div class="search-repuesto">
        <input type="text" placeholder="Buscar veh√≠culo..." class="input-repuesto" id="admin-buscador-flotas">
        <button class="btn-search-repuesto"><img src="../img/Buscar.svg" alt="Buscar"></button>
      </div>
      <span class="results-text" id="admin-contador-flotas" style="margin: 0 12px;">0 veh√≠culos</span>
      <button class="btn-text" id="btn-filtrar-admin-flotas">
        Filtrar <img src="../img/Filtros.svg" alt="Filtros">
      </button>
    </div>
  </div>

<!-- MODAL SELECCI√ìN AGREGAR VEH√çCULOS (ADMIN) -->
<div id="modal-admin-seleccion-agregar" class="overlay-flota" aria-hidden="true" style="z-index: 1000; display:none;">
  <div class="modal-flota">
    <div class="modal-flota-header">
      <span class="modal-flota-title">Agregar veh√≠culos</span>
      <button class="close-flota-btn" onclick="cerrarModalSeleccionAgregarVehiculo()">&times;</button>
    </div>
    <div class="modal-flota-body">
      <div class="section">
        <h3>Carga manual (uno a uno)</h3>
        <button class="btn-secondary" onclick="seleccionarAgregarManual()" style="width: 100%;">Agregar veh√≠culos</button>
      </div>
      <div class="section">
        <h3>Carga masiva (subir excel)</h3>
        <button class="btn-primary btn-white-svg" onclick="descargarPlantillaAdminAgregar()" style="width: 100%;">
          Descargar plantilla
          <img src="../img/descargarrr.svg" alt="descargar">
        </button>
      </div>
      <div class="section">
        <div id="dropzone-admin-agregar" class="dropzone">
          <img src="../img/Subir plantilla.svg" alt="Subir plantilla">
          <p>Arrastrar o subir el archivo</p>
        </div>
        <p id="fileName-admin-agregar" class="nf-file-name"></p>
        <input id="fileInput-admin-agregar" type="file" accept=".xlsx" hidden>
      </div>
    </div>
  </div>
  
</div>
  <div class="table-responsive" style="margin-top: 20px;">
    <table class="sc-table" id="tabla-flotas-admin">
      <thead>
        <tr>
          <th>Tipo de veh√≠culo</th>
          <th>Marca</th>
          <th>Modelo</th>
          <th>A√±o</th>
          <th>Motor (opcional)</th>
          <th>Patente</th>
          <th style="text-align: center;">Conductor</th>
          <th style="text-align: center;">Favoritos</th>
          <th style="text-align: center;">Editar</th>
        </tr>
      </thead>
      <tbody id="tbody-flotas-admin">
        <tr>
            <td colspan="9" style="text-align:center; padding:40px; color:#999;">
                Seleccione una flota para ver el listado de veh√≠culos.
            </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination">
    <button class="page-btn arrow">&lt;</button>
    <button class="page-btn active">1</button>
    <button class="page-btn arrow">&gt;</button>
  </div>
</section>

   <section id="repuestos" class="admin-section">
      <div class="section-header-row">
        <h2 class="section-title">Lista de Repuestos del Cliente</h2>
        <button class="btn-primary" onclick="adminAbrirModalSubirProductos()">Subir productos al cliente</button>
      </div>

      <div class="toolbar-products">
        <div class="toolbar-left">
            <div class="search-repuesto">
                <input type="text" placeholder="Buscar por c√≥digo o repuesto..." class="input-repuesto" id="admin-buscador-repuestos">
                <button class="btn-search-repuesto"><img src="../img/Buscar.svg" alt="Buscar"></button>
            </div>
            <span class="results-text" id="admin-contador-repuestos">Cargando datos...</span>
        </div>
        <div class="toolbar-right">
            <button class="btn-text" id="btn-filtrar-admin-repuestos">
                Filtrar <img src="../img/Filtros.svg" alt="Filtros">
            </button>
        </div>
      </div>

      <div class="table-responsive">
        <table class="sc-table">
          <thead>
            <tr>
              <th>L√≠nea</th>
              <th>C√≥d. StarClutch</th>
              <th>Descripci√≥n</th>
              <th>Marca</th>
              <th>C√≥d. Cliente</th>
              <th>Precio autorizado</th>
              <th>Descuento</th>
              <th>Stock</th>
              <th style="text-align: center;">Fotos</th>
              <th style="text-align: center; width: 100px;">Ficha T√©cnica</th>
              <th style="text-align: center;">Editar</th>
              <th style="text-align: center;">Recomendar</th>
            </tr>
          </thead>
          <tbody id="tbody-repuestos-admin">
             <tr>
               <td colspan="12" style="text-align:center; padding:30px; color:#999;">
                  Seleccione un cliente para ver sus repuestos.
               </td>
             </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination">
        <button class="page-btn arrow">&lt;</button>
        <button class="page-btn active">1</button>
        <button class="page-btn arrow">&gt;</button>
      </div>
    </section>

    <section id="ofertas" class="admin-section">
      <div class="section-header-row" style="margin-bottom: 24px;">
        <div>
          <h2 class="section-title">Campa√±as de Ofertas Exclusivas</h2>
          <p style="color: #666; font-size: 14px; margin-top: 8px;">Crea campa√±as promocionales con banners personalizados y productos espec√≠ficos. Cada campa√±a se muestra en el carrusel de ofertas del cliente.</p>
        </div>
        <button class="btn-primary" onclick="abrirModalNuevaCampana()" style="white-space: nowrap;">
          + Nueva Campa√±a
        </button>
      </div>

      <!-- Info cards -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
        <div style="padding: 16px; background: #ffffff; border: 2px solid #BF1823; border-radius: 12px; color: #BF1823;">
          <div style="font-size: 13px; opacity: 0.9; margin-bottom: 4px;">Carrusel Principal</div>
          <div style="font-size: 24px; font-weight: 700;" id="count-principal">0</div>
          <div style="font-size: 12px; opacity: 0.8; margin-top: 4px;">campa√±as activas</div>
        </div>
        <div style="padding: 16px; background: #ffffff; border: 2px solid #BF1823; border-radius: 12px; color: #BF1823;">
          <div style="font-size: 13px; opacity: 0.9; margin-bottom: 4px;">Carrusel Secundario</div>
          <div style="font-size: 24px; font-weight: 700;" id="count-secundario">0</div>
          <div style="font-size: 12px; opacity: 0.8; margin-top: 4px;">campa√±as activas</div>
        </div>
      </div>

      <!-- Lista de campa√±as -->
      <div id="campanas-list" style="display: flex; flex-direction: column; gap: 20px; margin-bottom: 24px;">
        <!-- Aqu√≠ se renderizan las campa√±as din√°micamente -->
      </div>
      
      <!-- Empty State -->
      <div id="campanas-empty-state" style="text-align: center; padding: 60px 20px; background: #f8f9fa; border-radius: 12px; border: 2px dashed #ddd; margin-bottom: 24px;">
        <img src="../img/Descuento.svg" alt="" style="width: 64px; height: 64px; opacity: 0.3; margin-bottom: 16px;">
        <p style="color: #999; font-size: 15px; margin-bottom: 8px;">No hay campa√±as creadas</p>
        <p style="color: #bbb; font-size: 13px;">Haz clic en "+ Nueva Campa√±a" para comenzar</p>
      </div>

      <!-- Bot√≥n guardar -->
      <div class="banner-actions-row">
        <button class="btn-primary btn-guardar-banners" onclick="guardarTodasLasCampanas()" style="font-size: 15px; padding: 12px 32px;">
          Guardar todas las campa√±as
        </button>
        <span class="banner-save-status" id="banner-save-status"></span>
      </div>
    </section>

    <!-- MODAL NUEVA/EDITAR CAMPA√ëA V2 -->
    <div id="modal-campana" class="sc-modal-overlay" style="display: none;">
      <div class="sc-modal-container" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
        <div class="sc-modal-header">
          <h3 id="modal-campana-title">Nueva Campa√±a</h3>
          <button class="btn-close-modal" onclick="cerrarModalCampana()">&times;</button>
        </div>
        
        <div class="sc-modal-body" style="padding: 24px;">
          <!-- Informaci√≥n b√°sica -->
          <div class="campana-form-section" style="margin-bottom: 24px;">
            <div style="display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: end;">
              <div class="form-group">
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333; font-size: 14px;">
                  Nombre de la campa√±a *
                </label>
                <input type="text" id="campana-nombre" class="sc-input" placeholder="Ej: Promoci√≥n Navidad 2024" style="font-size: 14px;">
                <p style="font-size: 12px; color: #666; margin-top: 4px;">Para tu referencia interna</p>
              </div>
              
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 12px 16px; background: #f8f9fa; border-radius: 8px; border: 2px solid #e0e0e0; transition: all 0.2s;">
                <input type="checkbox" id="campana-activa" checked style="width: 18px; height: 18px; cursor: pointer; accent-color: #BF1823;">
                <span style="font-weight: 600; font-size: 14px; color: #333; white-space: nowrap;">Campa√±a Activa</span>
              </label>
            </div>
          </div>

          <!-- Tabs: Principal / Secundario -->
          <div class="campana-tabs">
            <button type="button" class="campana-tab active" data-tipo="principal" onclick="cambiarTabModal('principal')">
              <span class="campana-tab-icon">üåü</span> Principal
            </button>
            <button type="button" class="campana-tab" data-tipo="secundario" onclick="cambiarTabModal('secundario')">
              <span class="campana-tab-icon">üéØ</span> Secundario
            </button>
          </div>

          <!-- Contenedor de slides -->
          <div id="slides-container-modal">
            <!-- Los slides se renderizan din√°micamente aqu√≠ -->
          </div>

          <!-- Bot√≥n agregar slide -->
          <button type="button" class="btn-add-slide" onclick="agregarSlideModal()">
            + Agregar Slide
          </button>
        </div>

        <div class="sc-modal-footer" style="padding: 16px 24px; background: #f8f9fa; border-top: 1px solid #e0e0e0; display: flex; justify-content: space-between;">
          <button class="btn-secondary" onclick="cerrarModalCampana()">Cancelar</button>
          <button class="btn-primary" onclick="guardarCampanaModal()">Guardar Campa√±a</button>
        </div>
      </div>
    </div>

    <section id="cuenta" class="admin-section">
      <div class="section-header-row">
        <h2 class="section-title">Estado de la Cuenta</h2>
        <div class="admin-actions">
          <button class="btn-primary">Subir factura</button>
          <button class="btn-secondary">Subir factura pendiente</button>
        </div>
      </div>

      <div class="account-dashboard">
        
        <div class="invoices-container">
          <div class="dashboard-box-header">
              <h3>Facturas del cliente</h3>
              <div class="date-filters">
                  <div class="date-group">
                      <label>Desde:</label>
                      <input type="date" class="sc-input-date">
                  </div>
                  <div class="date-group">
                      <label>Hasta:</label>
                      <input type="date" class="sc-input-date">
                  </div>
              </div>
          </div>

          <div class="table-responsive">
            <table class="sc-table">
              <thead>
                <tr>
                  <th>N¬∞ Factura</th>
                  <th>Fecha</th>
                  <th>Monto</th>
                  <th>Estado</th>
                  <th>Acci√≥n</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>#FAC-00123</td>
                  <td>12/10/2024</td>
                  <td>$1.500.000</td>
                  <td><span class="status-badge paid">Pagado</span></td>
                  <td><button class="btn-text">Ver</button></td>
                </tr>
                <tr>
                  <td>#FAC-00124</td>
                  <td>25/10/2024</td>
                  <td>$890.000</td>
                  <td><span class="status-badge pending">Pendiente</span></td>
                  <td><button class="btn-text">Ver</button></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="chart-container">
          <div class="dashboard-box-header">
              <h3>Total Invertido</h3>
              <div class="date-filters vertical-mobile">
                  <div class="date-group">
                      <label>Desde:</label>
                      <input type="date" class="sc-input-date small">
                  </div>
                  <div class="date-group">
                      <label>Hasta:</label>
                      <input type="date" class="sc-input-date small">
                  </div>
              </div>
          </div>

          <div class="bar-chart">
            <div class="chart-col"><div class="bar" style="height: 40%;"></div><span class="label">JUN</span></div>
            <div class="chart-col"><div class="bar" style="height: 60%;"></div><span class="label">JUL</span></div>
            <div class="chart-col"><div class="bar" style="height: 30%;"></div><span class="label">AGO</span></div>
            <div class="chart-col"><div class="bar" style="height: 80%;"></div><span class="label">SEP</span></div>
            <div class="chart-col"><div class="bar" style="height: 50%;"></div><span class="label">OCT</span></div>
            <div class="chart-col"><div class="bar highlight" style="height: 90%;"></div><span class="label">NOV</span></div>
          </div>
          <div class="chart-total">Total periodo: <strong>$35.400.000</strong></div>
        </div>
      </div>

      <div class="top-lists-grid">
        <div class="top-list-box">
          <h3>Top 20 Repuestos (Mayor rotaci√≥n)</h3>
          <ul class="ranking-list">
            <li><span>1. Kit Embrague Scania</span> <strong>150 u.</strong></li>
            <li><span>2. Filtro Aceite Volvo</span> <strong>120 u.</strong></li>
            <li class="more">Ver lista completa...</li>
          </ul>
        </div>
        <div class="top-list-box">
          <h3>Top 10 Veh√≠culos (Mayor recambio)</h3>
          <ul class="ranking-list">
            <li><span>1. Scania R500</span> <strong>$5.2M</strong></li>
            <li><span>2. Volvo FH16</span> <strong>$4.8M</strong></li>
            <li class="more">Ver lista completa...</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="compras" class="admin-section">
      <h2 class="section-title">Historial de Compras</h2>
      <div class="table-responsive">
        <table class="sc-table">
          <thead>
            <tr>
              <th>ID Pedido</th>
              <th>Fecha</th>
              <th>Items</th>
              <th>Total</th>
              <th>Estado Despacho</th> <th>Documentos</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>#ORD-9988</td>
              <td>10/11/2024</td>
              <td>5 productos</td>
              <td>$1.200.000</td>
              <td>
                <button class="btn-secondary btn-radius-16">Ver Despacho</button>
              </td>
              <td>
                <button class="btn-text">Descargar Factura</button>
              </td>
            </tr>
            <tr>
              <td>#ORD-9987</td>
              <td>01/11/2024</td>
              <td>2 productos</td>
              <td>$450.000</td>
              <td>
                <button class="btn-secondary btn-radius-16">Ver Despacho</button>
              </td>
              <td>
                <button class="btn-text">Descargar Factura</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

  </main>


<div id="modal-subir-productos" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 1200px;"> 
      
      <div class="sc-modal-header">
        <h3>Subir productos al cliente</h3>
        <button class="btn-close-modal" id="btn-close-modal">&times;</button>
      </div>

      <div class="sc-modal-body">
        
        <!-- Nueva secci√≥n de b√∫squeda r√°pida -->
        <div style="background: #f0f8ff; border: 2px solid #4a90e2; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
            <img src="../img/Buscar.svg" alt="Buscar" style="width: 20px; height: 20px;">
            <h4 style="margin: 0; color: #2c5aa0;">B√∫squeda R√°pida de Productos</h4>
          </div>
          <p style="margin: 0 0 12px 32px; font-size: 13px; color: #555;">
            Busca por SKU, nombre o marca. Selecciona los productos que quieras agregar con los checkboxes. Se copiar√° toda la informaci√≥n excepto precio, descuento y recomendado.
          </p>
          <div style="margin-left: 32px; position: relative;">
            <div style="position: relative;">
              <input type="text" id="buscar-sku-rapido" class="sc-input" placeholder="Escribe para buscar: SKU, nombre del repuesto o marca..." style="width: 100%;" 
                     oninput="cargarSugerenciasSKU(this.value)" 
                     onfocus="mostrarSugerencias(true)"
                     autocomplete="off">
              <div id="sugerencias-sku-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #4a90e2; border-top: none; border-radius: 0 0 8px 8px; max-height: 350px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"></div>
            </div>
            <div id="productos-seleccionados" style="margin-top: 12px; display: none;">
              <div style="background: #e8f5e9; border: 2px solid #4caf50; border-radius: 6px; padding: 12px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                  <strong style="color: #2e7d32;">‚úì <span id="count-seleccionados">0</span> producto(s) seleccionado(s)</strong>
                  <button class="btn-primary" onclick="agregarProductosSeleccionados()" style="font-size: 13px; padding: 8px 16px;">
                    ‚ûï Agregar a la tabla
                  </button>
                </div>
                <div id="lista-productos-seleccionados" style="font-size: 12px; color: #555; max-height: 100px; overflow-y: auto;"></div>
              </div>
            </div>
          </div>
          <div id="resultado-busqueda-sku" style="margin-top: 12px; margin-left: 32px; display: none;"></div>
        </div>
        
        <div class="table-responsive">
          <table class="sc-table upload-table" id="tabla-productos-upload">
            <thead>
              <tr>
                <th>Cod. Cliente (Opc)</th>
                <th>Repuesto (Escribir)</th>
                <th>Marca (Escribir)</th>
                <th>L√≠nea (Auto)</th>
                <th>C√≥d. StarClutch *</th>
                <th>Precio ($)</th>
                <th>Descuento (%)</th>
                <th>Stock</th>
                <th style="width: 220px;">Im√°genes</th>
                <th style="width: 100px; text-align: center;">Ficha T√©cnica</th>
                <th style="width: 50px;"></th>
              </tr>
            </thead>
            <tbody>
              <!-- Tabla vac√≠a inicialmente - usar bot√≥n "+ Agregar otro producto" para agregar filas -->
            </tbody>
          </table>
        </div>

        <div class="modal-actions-row">
            <button class="btn-text" onclick="agregarFila()">
                <span style="font-size:18px; margin-right:5px;">+</span> Agregar otro producto
            </button>
        </div>

        <datalist id="lista-repuestos">
            <option value="Kit de embrague">
            <option value="Kit de embrague + Volante">
            <option value="Volantes">
            <option value="Discos de embrague">
            <option value="Rodamiento">
            <option value="Prensa">
            <option value="Servo">
            <option value="Componente AMT.V">
            <option value="Caliper y kit">
            <option value="Pastillas de freno">
            <option value="Disco de freno">
            <option value="Tambor de freno">
            <option value="Patines">
            <option value="Balatas">
            <option value="Pulm√≥n de freno">
            <option value="Mazas">
            <option value="Freno motor">
            <option value="Chicharras">
            <option value="Pulm√≥n de suspensi√≥n">
            <option value="Pulm√≥n de levante">
            <option value="Fuelle">
            <option value="Filtro de aceite">
            <option value="Filtro de aire">
            <option value="Filtro de cabina">
            <option value="Filtro de combustible">
            <option value="Filtro separador">
            <option value="Filtro hidr√°ulico">
            <option value="V√°lvula">
            <option value="Secador">
            <option value="Compresor">
            <option value="Correa">
            <option value="Barra de direcci√≥n">
            <option value="Barra estabilizadora">
            <option value="Barra tensora">
            <option value="Barras en V">
            <option value="Terminales de direcci√≥n">
            <option value="Soporte">
        </datalist>

        <datalist id="lista-marcas">
            <option value="ACE"><option value="AIRTECH"><option value="AKROL">
            <option value="ALLIANCE"><option value="AUTIMPEX"><option value="CASTERTECH">
            <option value="CRB"><option value="EATON"><option value="EXEDY">
            <option value="FAG"><option value="FERSA"><option value="FLEETGUARD">
            <option value="FLYTECH"><option value="FRASLE"><option value="HTECH">
            <option value="JOST"><option value="KNORR BREMSE"><option value="LEMFORDER">
            <option value="LUK"><option value="MASTER"><option value="MERITOR">
            <option value="SAB"><option value="SACHS"><option value="SUSPENSYS">
            <option value="VALEO"><option value="WABCO">
        </datalist>

      </div>

      <div class="sc-modal-footer">
        <button class="btn-secondary" onclick="cerrarModal()">Cancelar</button>
        <button class="btn-primary" onclick="cargarProductosAlCliente()">Cargar productos</button>
      </div>

    </div>
  </div>
  
  <div id="modal-preview-img" class="sc-modal-overlay" style="z-index: 2000;">
    <div class="preview-container">
      <button class="btn-close-preview" onclick="cerrarPreview()">&times;</button>
      <img id="img-preview-src" src="" alt="Vista previa">
      <p id="img-preview-name" style="color: white; text-align: center; margin-top: 10px;"></p>
    </div>
  </div>

<!-- MODAL SELECCI√ìN DE TIPO DE CARGA (ADMIN) -->
<div id="modal-admin-seleccion-carga" class="overlay-flota" aria-hidden="true" style="z-index: 1000;">
  <div class="modal-flota">
    
    <!-- HEADER -->
    <div class="modal-flota-header">
      <span class="modal-flota-title">Nueva flota</span>
      <button class="close-flota-btn" onclick="cerrarModalSeleccionCargaFlota()">&times;</button>
    </div>

    <!-- BODY -->
    <div class="modal-flota-body">
      <div class="section">
        <h3>Carga manual (uno a uno)</h3>
        <button class="btn-secondary" onclick="seleccionarCargaManual()" style="width: 100%;">
          Agregar veh√≠culos
        </button>
      </div>

      <div class="section">
        <h3>Carga masiva (subir excel)</h3>
        <button class="btn-primary btn-white-svg" onclick="descargarPlantillaAdmin()" style="width: 100%;">
          Descargar plantilla
          <img src="../img/descargarrr.svg" alt="descargar">
        </button>
      </div>

      <div class="section">
        <div id="dropzone-admin" class="dropzone">
          <img src="../img/Subir plantilla.svg" alt="Subir plantilla">
          <p>Arrastrar o subir el archivo</p>
        </div>
        <p id="fileName-admin" class="nf-file-name"></p>
        <input id="fileInput-admin" type="file" accept=".xlsx" hidden>
      </div>
    </div>

  </div>
</div>

<!-- MODAL NOMBRAR FLOTA IMPORTADA (ADMIN) -->
<div id="modal-admin-nombrar-flota" class="overlay-flota" aria-hidden="true" style="z-index: 1001;">
  <div class="modal-flota-small">
    <div class="modal-flota-header">
      <span>Nombra la flota del cliente</span>
      <button class="close-flota-btn" onclick="cerrarModalNombrarFlotaAdmin()">&times;</button>
    </div>
    <div class="modal-flota-body">
      <p class="flota-modal-text" style="text-align: center; margin-bottom: 16px; font-size: 14px; color: #333;">
        Ingresa un nombre para identificar la flota que acabas de subir.
      </p>
      <input type="text" id="admin-input-nombre-flota-excel" placeholder="Ej: Flota Zona Sur" class="flota-input-text" />
      <button id="btn-confirmar-importacion-admin" class="btn-primary" style="margin-top:15px; width: 100%;">Guardar Flota</button>
    </div>
  </div>
</div>

 <div id="modal-admin-crear-flota" class="sc-modal-overlay">
  <div class="sc-modal-container" style="max-width: 900px; width: 95%;">
    <div class="sc-modal-header">
      <h3>Crear Nueva Flota para el Cliente</h3>
      <button class="btn-close-modal" onclick="adminCerrarModalNuevaFlota()">&times;</button>
    </div>
    <div class="sc-modal-body" style="padding: 24px;">
      <div class="form-group" style="margin-bottom: 24px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 500;">Nombre de la Flota</label>
        <input type="text" id="admin-input-nombre-flota" class="sc-input" placeholder="Ej: Flota Zona Sur" style="padding: 10px;">
      </div>

      <div id="admin-lista-nuevos-vehiculos" style="max-height: 400px; overflow-y: auto; padding-right:5px; margin-bottom: 24px;">
        </div>

      <div class="modal-actions-row" style="margin-top: 16px;">
         <button class="btn-secondary btn-dashed" onclick="adminAgregarFilaVehiculo()" style="padding: 12px 20px;">
           + Agregar otro veh√≠culo
         </button>
      </div>
    </div>
    <div class="sc-modal-footer" style="padding: 16px 24px;">
      <div style="margin-right:auto; font-size:14px; color:#666;">
         Total: <span id="admin-total-nuevos">0</span> veh√≠culos
      </div>
      <button class="btn-secondary" onclick="adminCerrarModalNuevaFlota()">Cancelar</button>
      <button class="btn-primary" onclick="adminGuardarNuevaFlota()">Guardar Flota</button>
    </div>
  </div>
</div>

<!-- MODAL AGREGAR VEH√çCULOS A FLOTA EXISTENTE -->
<div id="modal-admin-agregar-vehiculo" class="sc-modal-overlay">
  <div class="sc-modal-container" style="max-width: 900px; width: 95%;">
    <div class="sc-modal-header">
      <h3>Agregar veh√≠culos a la flota "<span id="admin-nombre-flota-actual"></span>"</h3>
      <button class="btn-close-modal" onclick="adminCerrarModalAgregarVehiculo()">&times;</button>
    </div>
    <div class="sc-modal-body" style="padding: 24px;">
      <div id="admin-lista-agregar-vehiculos" style="max-height: 400px; overflow-y: auto; padding-right:5px; margin-bottom: 24px;">
      </div>

      <div class="modal-actions-row" style="margin-top: 16px;">
         <button class="btn-secondary btn-dashed" onclick="adminAgregarFilaVehiculoAgregar()" style="padding: 12px 20px;">
           + Agregar otro veh√≠culo
         </button>
      </div>
    </div>
    <div class="sc-modal-footer" style="padding: 16px 24px;">
      <div style="margin-right:auto; font-size:14px; color:#666;">
         Total a agregar: <span id="admin-total-agregar">0</span> veh√≠culos
      </div>
      <button class="btn-secondary" onclick="adminCerrarModalAgregarVehiculo()">Cancelar</button>
      <button class="btn-primary" onclick="adminGuardarVehiculosAgregados()">Agregar veh√≠culos</button>
    </div>
  </div>
</div>

<!-- MODAL EDICI√ìN VEH√çCULO ADMIN (MODERNA) -->
<div id="overlay-editar-vehiculo-admin" class="overlay-editar-unique" aria-hidden="true">
  <div class="modal-editar-unique">

    <!-- HEADER -->
    <div class="modal-editar-header-unique">
      <span class="modal-editar-title-unique">Editar veh√≠culo (Admin)</span>
      <button id="cerrar-editar-vehiculo-admin" class="modal-editar-close-unique">&times;</button>
    </div>

    <!-- BODY -->
    <div class="modal-editar-body-unique">

      <!-- LEFT: IMAGEN + BOTONES -->
      <div class="modal-left-col-unique">

        <!-- FAVORITOS ARRIBA DE LA IMAGEN -->
        <div class="modal-fav-container">
          <button type="button" id="btn-favorito-modal-admin" class="btn-favorito-modal" style="display: flex; align-items: center; gap: 8px; margin-top: 10px; background: none; border: none; cursor: pointer; color: #575657;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
            <span id="txt-favorito-modal-admin" style="font-weight: 500;">Agregar a favoritos</span>
          </button>
        </div>

        <!-- IMAGEN VEH√çCULO CON INPUT DENTRO -->
        <div class="modal-vehiculo-img-unique" style="position: relative;">
          <img src="../img/americano.png" class="modal-vehiculo-foto-unique" id="admin-img-vehiculo" alt="Veh√≠culo">
          <img src="../logosvehiculos/agrale.png" alt="Marca" class="modal-logo-marca" id="admin-logo-marca">

          <!-- INPUT ASIGNAR CONDUCTOR centrado abajo -->
          <div class="input-conductor-container">
            <input type="text" placeholder="Asignar conductor" class="input-asignar-conductor" id="admin-input-conductor">
          </div>
        </div>

        <!-- BOT√ìN ELIMINAR VEH√çCULO -->
        <button class="btn-secondary btn-delete-vehiculo-unique" id="btn-admin-eliminar-vehiculo">
          <img src="../img/Delete.svg" alt="Eliminar"> Eliminar veh√≠culo
        </button>

      </div>

      <!-- RIGHT: FORMULARIO -->
      <div class="modal-right-col-unique">
        <input type="hidden" id="admin-edit-index-vehiculo">
        <div class="modal-form-block-unique">
          <div class="modal-form-row-unique">
            <label>Tipo de veh√≠culo</label>
            <select class="tipo-vehiculo" id="admin-edit-tipo">
              <option value="">Seleccionar tipo</option>
            </select>
          </div>
          <div class="modal-form-row-unique">
            <label>Marca</label>
            <select class="marca" id="admin-edit-marca" disabled>
              <option value="">Seleccionar marca</option>
            </select>
          </div>
          <div class="modal-form-row-unique">
            <label>Modelo</label>
            <select class="modelo" id="admin-edit-modelo" disabled>
              <option value="">Seleccionar modelo</option>
            </select>
          </div>
          <div class="modal-form-row-unique">
            <label>A√±o</label>
            <input type="number" class="anio" id="admin-edit-anio" placeholder="Digitar a√±o" onwheel="this.blur()">
          </div>
          <div class="modal-form-row-unique">
            <label>Motor (opcional)</label>
            <input type="text" class="motor" id="admin-edit-motor" placeholder="Digitar motor">
          </div>
          <div class="modal-form-row-unique">
            <label>Patente</label>
            <input type="text" class="patente" id="admin-edit-patente" placeholder="Digitar patente">
          </div>
        </div>

        <div class="modal-actions-unique">
          <button class="btn-secondary modal-cancelar-unique" id="btn-admin-cancelar">Cancelar</button>
          <button class="btn-primary modal-guardar-unique" id="btn-admin-guardar">Guardar cambios</button>
        </div>
      </div>

    </div>
  </div>
</div>

<div id="modal-editar-producto" class="sc-modal-overlay">
  <div class="sc-modal-container" style="max-width: 900px;">
    <div class="sc-modal-header">
      <h3>Editar Producto</h3>
      <button class="btn-close-modal" onclick="cerrarModalEditarProducto()">&times;</button>
    </div>
    
    <div class="sc-modal-body" style="padding: 24px; overflow-y: auto; max-height: 80vh;">
      <input type="hidden" id="edit-producto-id">
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
        <div class="form-group">
          <label>C√≥digo Cliente (Opcional)</label>
          <input type="text" id="edit-cod-cliente" class="sc-input">
        </div>
        <div class="form-group">
          <label>C√≥digo StarClutch *</label>
          <input type="text" id="edit-cod-sc" class="sc-input">
        </div>
      </div>

      <div class="form-group" style="margin-bottom: 16px;">
        <label>Repuesto *</label>
        <select id="edit-repuesto" class="sc-input" onchange="detectarLineaEdit(this)">
          <option value="">Seleccionar repuesto...</option>
          <option value="Kit de embrague">Kit de embrague</option>
          <option value="Kit de embrague + Volante">Kit de embrague + Volante</option>
          <option value="Volantes">Volantes</option>
          <option value="Discos de embrague">Discos de embrague</option>
          <option value="Rodamiento">Rodamiento</option>
          <option value="Prensa">Prensa</option>
          <option value="Servo">Servo</option>
          <option value="Componente AMT.V">Componente AMT.V</option>
          <option value="Caliper y kit">Caliper y kit</option>
          <option value="Pastillas de freno">Pastillas de freno</option>
          <option value="Disco de freno">Disco de freno</option>
          <option value="Tambor de freno">Tambor de freno</option>
          <option value="Patines">Patines</option>
          <option value="Balatas">Balatas</option>
          <option value="Pulm√≥n de freno">Pulm√≥n de freno</option>
          <option value="Mazas">Mazas</option>
          <option value="Freno motor">Freno motor</option>
          <option value="Chicharras">Chicharras</option>
          <option value="Pulm√≥n de suspensi√≥n">Pulm√≥n de suspensi√≥n</option>
          <option value="Pulm√≥n de levante">Pulm√≥n de levante</option>
          <option value="Fuelle">Fuelle</option>
          <option value="Filtro de aceite">Filtro de aceite</option>
          <option value="Filtro de aire">Filtro de aire</option>
          <option value="Filtro de cabina">Filtro de cabina</option>
          <option value="Filtro de combustible">Filtro de combustible</option>
          <option value="Filtro separador">Filtro separador</option>
          <option value="Filtro hidr√°ulico">Filtro hidr√°ulico</option>
          <option value="V√°lvula">V√°lvula</option>
          <option value="Secador">Secador</option>
          <option value="Compresor">Compresor</option>
          <option value="Correa">Correa</option>
          <option value="Barra de direcci√≥n">Barra de direcci√≥n</option>
          <option value="Barra estabilizadora">Barra estabilizadora</option>
          <option value="Barra tensora">Barra tensora</option>
          <option value="Barras en V">Barras en V</option>
          <option value="Terminales de direcci√≥n">Terminales de direcci√≥n</option>
          <option value="Soporte">Soporte</option>
        </select>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
        <div class="form-group">
          <label>Marca</label>
          <input list="lista-marcas" id="edit-marca" class="sc-input">
        </div>
        <div class="form-group">
          <label>L√≠nea (Auto)</label>
          <input type="text" id="edit-linea" class="sc-input" readonly>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 16px;">
        <div class="form-group">
          <label>Precio ($)</label>
          <input type="text" id="edit-precio" class="sc-input" min="0" oninput="formatearPrecioInput(this)">
        </div>
        <div class="form-group">
          <label>Descuento (%)</label>
          <input type="number" id="edit-descuento" class="sc-input" step="0.01" min="0" max="100">
        </div>
        <div class="form-group">
          <label>Stock</label>
          <input type="number" id="edit-stock" class="sc-input" min="0" step="1">
        </div>
      </div>

      <div class="form-group" style="margin-bottom: 16px;">
        <label>Im√°genes del Producto</label>
        <div class="upload-wrapper">
          <label class="btn-mini-upload" style="cursor:pointer; display:flex; align-items:center; justify-content:center; padding:8px 16px; background:#333; color:#fff; border-radius:4px;">
            <input type="file" multiple id="edit-input-fotos" accept="image/*" onchange="manejarFotosEdicion(this)" style="display:none;">
            <span>+ Agregar m√°s fotos</span>
          </label>
          <div id="edit-fotos-container" style="display:flex; flex-wrap:wrap; gap:12px; margin-top:12px; padding:8px;"></div>
        </div>
      </div>

      <button class="btn-primary" onclick="abrirModalFichaTecnicaEdicion()" style="margin-top: 16px; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;">
        <img src="../img/fichatecnica.svg" alt="Ficha T√©cnica" style="width: 18px; height: 18px; filter: brightness(0) invert(1);">
        Editar Ficha T√©cnica
      </button>
    </div>

    <div class="sc-modal-footer" style="display: flex; justify-content: space-between; align-items: center;">
      <button class="btn-danger" onclick="eliminarProducto()" style="background: #BF1823; color: white; border: none; padding: 10px 20px; border-radius: 16px; cursor: pointer; font-weight: 600; transition: background 0.2s; display: inline-flex; align-items: center; gap: 8px;" onmouseover="this.style.background='#b71c1c'" onmouseout="this.style.background='#d32f2f'">
        <img src="../img/Deleteblanco.svg" alt="Eliminar" style="width: 16px; height: 16px;"> Eliminar Producto
      </button>
      <div style="display: flex; gap: 12px;">
        <button class="btn-secondary" onclick="cerrarModalEditarProducto()">Cancelar</button>
        <button class="btn-primary" onclick="guardarEdicionProducto()">Guardar Cambios</button>
      </div>
    </div>
  </div>
</div>

  <div id="modal-ficha-tecnica" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 700px;">
      <div class="sc-modal-header">
        <h3>Agregar Ficha T√©cnica</h3>
        <button class="btn-close-modal" onclick="cerrarModalFichaTecnica()">&times;</button>
      </div>
      
      <div class="sc-modal-body">
        <div class="form-group">
          <label>Ficha T√©cnica</label>
          <textarea id="ficha-tecnica-input" class="sc-input" placeholder="Ej: Di√°metro: 225 mm&#10;N√∫mero de estr√≠as: 24&#10;Peso: 42.5 kg" style="min-height: 150px; font-family: monospace;"></textarea>
          <small style="color: #999; display: block; margin-top: 8px;">üí° Lo que escribas antes del &quot;:&quot; aparecer√° en <strong>negrita</strong></small>
        </div>

        <div class="form-group">
          <label>Referencia Cruzada</label>
          <textarea id="referencia-cruzada-input" class="sc-input" placeholder="Ej: OEM-123456&#10;Referencia Alternativa 2" style="min-height: 100px; font-family: monospace;"></textarea>
        </div>

        <div class="form-group">
          <label>OEM (C√≥digo Original)</label>
          <textarea id="oem-input" class="sc-input" placeholder="Ej: 1234567890&#10;OEM Alternativo" style="min-height: 100px; font-family: monospace;"></textarea>
        </div>
      </div>

      <div class="sc-modal-footer">
        <button class="btn-secondary" onclick="cerrarModalFichaTecnica()">Cancelar</button>
        <button class="btn-primary" onclick="guardarFichaTecnica()">Guardar Ficha T√©cnica</button>
      </div>
    </div>
  </div>

  <div id="modal-ficha-tecnica-edicion" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 700px;">
      <div class="sc-modal-header">
        <h3>Editar Ficha T√©cnica</h3>
        <button class="btn-close-modal" onclick="cerrarModalFichaTecnicaEdicion()">&times;</button>
      </div>
      
      <div class="sc-modal-body">
        <div class="form-group" style="margin-bottom: 24px;">
          <label>Ficha T√©cnica</label>
          <textarea id="ficha-tecnica-edit-input" class="sc-input" style="min-height: 150px; font-family: monospace;" placeholder="Ej: Di√°metro: 225 mm&#10;N√∫mero de estr√≠as: 24&#10;Peso: 42.5 kg"></textarea>
          <small style="color: #999; display: block; margin-top: 8px;">üí° Lo que escribas antes del &quot;:&quot; aparecer√° en <strong>negrita</strong></small>
        </div>

        <div class="form-group" style="margin-bottom: 24px;">
          <label>Referencia Cruzada</label>
          <textarea id="referencia-cruzada-edit-input" class="sc-input" style="min-height: 100px; font-family: monospace;" placeholder="Ej: OEM-123456&#10;Referencia Alternativa 2"></textarea>
        </div>

        <div class="form-group">
          <label>OEM (C√≥digo Original)</label>
          <textarea id="oem-edit-input" class="sc-input" style="min-height: 100px; font-family: monospace;" placeholder="Ej: 1234567890&#10;OEM Alternativo"></textarea>
        </div>
      </div>

      <div class="sc-modal-footer">
        <button class="btn-secondary" id="btn-cerrar-ficha" onclick="cerrarModalFichaTecnicaEdicion()">Cerrar</button>
        <button class="btn-primary" id="btn-guardar-ficha" onclick="guardarFichaTecnicaEdicion()">Guardar Cambios</button>
      </div>
    </div>
  </div>

  <!-- Modal Crear Usuario -->
  <div id="modal-crear-usuario" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 600px;">
      <div class="sc-modal-header">
        <h3>Crear Nueva Cuenta de Cliente</h3>
        <button class="btn-close-modal" onclick="cerrarModalCrearUsuario()">&times;</button>
      </div>
      
      <div class="sc-modal-body" style="padding: 24px;">
        <div class="form-group" style="margin-bottom: 16px;">
          <label>Nombre Empresa / Cliente</label>
          <input type="text" id="new-user-name" class="sc-input" placeholder="Ej: Transportes Vidal SpA">
        </div>

        <div class="form-group" style="margin-bottom: 16px;">
          <label>Correo Electr√≥nico</label>
          <input type="email" id="new-user-email" class="sc-input" placeholder="contacto@empresa.cl">
        </div>

        <div class="form-group" style="margin-bottom: 16px;">
          <label>Usuario (ID de acceso)</label>
          <input type="text" id="new-user-id" class="sc-input" placeholder="Ej: gonzalo">
        </div>

        <div class="form-group" style="margin-bottom: 16px;">
          <label>Contrase√±a</label>
          <input type="text" id="new-user-pass" class="sc-input" placeholder="Asignar contrase√±a">
        </div>
      </div>

      <div class="sc-modal-footer">
        <button class="btn-secondary" onclick="cerrarModalCrearUsuario()">Cancelar</button>
        <button class="btn-primary" onclick="crearNuevoUsuario()">
          <span style="font-size: 18px; margin-right: 5px;">+</span> Crear Usuario
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Agregar Modelo de Veh√≠culo -->
  <div id="modal-agregar-modelo-vehiculo" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 550px;">
      <div class="sc-modal-header">
        <h3>Agregar Modelo de Veh√≠culo</h3>
        <button class="btn-close-modal" onclick="cerrarModalAgregarModeloVehiculo()">√ó</button>
      </div>

      <div class="sc-modal-body" style="max-height: 70vh; overflow-y: auto;">
        <div class="form-group" style="margin-bottom: 24px;">
          <label>Tipo de Veh√≠culo</label>
          <div class="sc-select-wrapper">
            <select id="new-modelo-vehiculo-tipo" class="sc-input-select" onchange="cargarMarcasParaNuevoModelo()">
              <option value="" disabled selected>Selecciona un tipo</option>
              <option value="camion">Cami√≥n</option>
              <option value="bus">Bus / Van</option>
              <option value="camioneta">Camioneta</option>
              <option value="3/4">3/4</option>
              <option value="rampla">Rampla</option>
            </select>
          </div>
        </div>

        <div class="form-group" style="margin-bottom: 24px;">
          <label>Marca</label>
          <div class="sc-select-wrapper">
            <select id="new-modelo-vehiculo-marca" class="sc-input-select">
              <option value="" disabled selected>Selecciona una marca</option>
            </select>
          </div>
        </div>

        <div class="form-group" style="margin-bottom: 24px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; user-select: none;">
            <input type="checkbox" id="checkbox-marca-nueva" onchange="toggleMarcaNueva()" style="cursor: pointer; width: 18px; height: 18px;">
            <span style="font-weight: 500;">Agregar marca nueva</span>
          </label>
        </div>

        <div id="bloque-marca-nueva" style="display: none; opacity: 0; max-height: 0; overflow: hidden; transition: opacity 0.3s ease, max-height 0.3s ease; background: #f8f9fa; padding: 0 16px; border-radius: 8px; border-left: 3px solid var(--color-red); margin-bottom: 24px;">
          <div style="padding: 16px 0;">
            <div class="form-group" style="margin-bottom: 20px;">
              <label style="color: var(--color-red); font-weight: 600;">Nombre de la Nueva Marca</label>
              <input type="text" id="new-modelo-marca-nueva-nombre" class="sc-input" placeholder="Ej: Volvo, Scania, Mercedes" style="border-color: #ddd;">
            </div>

            <div class="form-group" style="margin-bottom: 0;">
              <label style="color: var(--color-red); font-weight: 600;">Logo de la Nueva Marca</label>
              <input type="file" id="new-modelo-marca-nueva-logo" class="sc-input" accept="image/*" style="cursor: pointer; border-color: #ddd;" onchange="previsualizarYPedirNombreArchivo('marca-nueva-logo')">
              <small style="color: #666;">Sube el logo de la marca (PNG, JPG, SVG) - Se guardar√° en logosvehiculos/</small>
              <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                <div id="preview-marca-nueva-logo" style="width: 100px; height: 100px; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; border-radius: 8px; overflow: hidden; background: white; flex-shrink: 0;">
                  <span style="color: #999;">Sin imagen</span>
                </div>
                <div id="nombre-archivo-marca-nueva-logo" style="flex: 1; color: #666; font-size: 13px;"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="form-group" style="margin-bottom: 24px;">
          <label>Nombre del Modelo</label>
          <input type="text" id="new-modelo-vehiculo-nombre" class="sc-input" placeholder="Ej: FH, FM, P">
        </div>

        <div class="form-group" style="margin-bottom: 16px;">
          <label>Imagen del Modelo</label>
          <input type="file" id="new-modelo-vehiculo-imagen" class="sc-input" accept="image/*" style="cursor: pointer;" onchange="previsualizarYPedirNombreArchivo('modelo-vehiculo-imagen')">
          <small style="color: #666;">Sube una imagen del modelo (PNG, JPG) - Se guardar√° en vehiculosexpertos/</small>
          <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
            <div id="preview-modelo-vehiculo-imagen" style="width: 100px; height: 100px; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; border-radius: 8px; overflow: hidden; flex-shrink: 0;">
              <span style="color: #999;">Sin imagen</span>
            </div>
            <div id="nombre-archivo-modelo-vehiculo-imagen" style="flex: 1; color: #666; font-size: 13px;"></div>
          </div>
        </div>
      </div>

      <div class="sc-modal-footer">
        <button class="btn-secondary" onclick="cerrarModalAgregarModeloVehiculo()">Cancelar</button>
        <button class="btn-primary" onclick="guardarModeloVehiculo()">
          <span style="font-size: 18px; margin-right: 5px;">+</span> Agregar Modelo
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Agregar Marca de Producto -->
  <div id="modal-agregar-marca-producto" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 500px;">
      <div class="sc-modal-header">
        <h3>Agregar Marca de Producto</h3>
        <button class="btn-close-modal" onclick="cerrarModalAgregarMarcaProducto()">√ó</button>
      </div>

      <div class="sc-modal-body">
        <div class="form-group" style="margin-bottom: 16px;">
          <label>Nombre de la Marca</label>
          <input type="text" id="new-marca-producto-nombre" class="sc-input" placeholder="Ej: Repuestos XYZ, Auto Parts">
        </div>

        <div class="form-group" style="margin-bottom: 16px;">
          <label>Logo de la Marca</label>
          <input type="file" id="new-marca-producto-logo" class="sc-input" accept="image/*" style="cursor: pointer;">
          <small style="color: #666;">Sube una imagen del logo (PNG, JPG, SVG)</small>
          <div id="preview-marca-producto-logo" style="margin-top: 10px; width: 100px; height: 100px; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; border-radius: 4px; overflow: hidden;">
            <span style="color: #999;">Sin imagen</span>
          </div>
        </div>
      </div>

      <div class="sc-modal-footer">
        <button class="btn-secondary" onclick="cerrarModalAgregarMarcaProducto()">Cancelar</button>
        <button class="btn-primary" onclick="guardarMarcaProducto()">
          <span style="font-size: 18px; margin-right: 5px;">+</span> Agregar Marca
        </button>
      </div>
    </div>
  </div>

  <!-- MODAL VER MARCAS Y MODELOS -->
  <div id="modal-ver-marcas-modelos" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 800px; max-height: 80vh;">
      <div class="sc-modal-header">
        <h3>Marcas y Modelos de Veh√≠culos</h3>
        <button class="btn-close-modal" onclick="cerrarModalVerMarcasModelos()">√ó</button>
      </div>
      <div class="sc-modal-body" style="max-height: 60vh; overflow-y: auto;">
        <div id="contenedor-marcas-modelos-visualizacion">
          <p style="text-align: center; color: #666;">Cargando...</p>
        </div>
      </div>
      <div class="sc-modal-footer">
        <button class="btn-secondary" onclick="cerrarModalVerMarcasModelos()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- MODAL VER MARCAS DE PRODUCTOS -->
  <div id="modal-ver-marcas-productos" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 700px; max-height: 80vh;">
      <div class="sc-modal-header">
        <h3>Marcas de Productos</h3>
        <button class="btn-close-modal" onclick="cerrarModalVerMarcasProductos()">√ó</button>
      </div>
      <div class="sc-modal-body" style="max-height: 60vh; overflow-y: auto;">
        <div id="contenedor-marcas-productos-visualizacion">
          <p style="text-align: center; color: #666;">Cargando...</p>
        </div>
      </div>
      <div class="sc-modal-footer">
        <button class="btn-secondary" onclick="cerrarModalVerMarcasProductos()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- MODAL EDITAR MARCA PRODUCTO -->
  <!-- ============================================================ -->
  <div id="modal-editar-marca-producto" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 600px;">
      <div class="sc-modal-header">
        <h3>‚úèÔ∏è Editar Marca de Producto</h3>
        <button class="btn-close-modal" onclick="cerrarModalEditarMarcaProducto()">√ó</button>
      </div>
      <div class="sc-modal-body">
        <input type="hidden" id="edit-marca-nombre-actual">
        <input type="hidden" id="edit-marca-index">
        
        <div class="sc-form-group">
          <label>Nombre de la marca</label>
          <input type="text" id="edit-marca-nombre" class="sc-input" placeholder="Ej: EXEDY">
        </div>

        <div class="sc-form-group">
          <label>Logo actual</label>
          <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; text-align: center; margin-bottom: 12px;">
            <img id="edit-marca-logo-preview" src="" alt="Logo actual" style="max-width: 150px; max-height: 100px; object-fit: contain;">
          </div>
        </div>

        <div class="sc-form-group">
          <label>Cambiar logo (opcional)</label>
          <input type="file" id="edit-marca-nuevo-logo" class="sc-input" accept="image/png,image/jpeg,image/jpg,image/svg+xml" style="padding: 8px;">
          <p style="font-size: 12px; color: #666; margin-top: 6px;">Formatos: PNG, JPG, SVG</p>
          
          <div id="edit-marca-nuevo-preview" style="display: none; background: #f8f9fa; padding: 16px; border-radius: 8px; text-align: center; margin-top: 12px; border: 2px dashed #4caf50;">
            <p style="font-size: 13px; color: #4caf50; font-weight: 600; margin-bottom: 8px;">‚úì Nueva imagen seleccionada</p>
            <img id="edit-marca-nuevo-logo-img" src="" alt="Nuevo logo" style="max-width: 150px; max-height: 100px; object-fit: contain;">
          </div>
        </div>
      </div>
      <div class="sc-modal-footer">
        <button class="btn-secondary" onclick="cerrarModalEditarMarcaProducto()">Cancelar</button>
        <button class="btn-primary" onclick="guardarEdicionMarcaProducto()">Guardar cambios</button>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- MODAL CRUCES DE VEH√çCULOS -->
  <!-- ============================================================ -->
  <div id="modal-cruces-vehiculos" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 700px;">
      <div class="sc-modal-header">
        <h3>üîó Cruces de Veh√≠culos - Productos</h3>
        <button class="btn-close-modal" onclick="cerrarModalCrucesVehiculos()">√ó</button>
      </div>
      <div class="sc-modal-body">
        <div style="margin-bottom: 20px;">
          <p style="color: #666; font-size: 14px; margin-bottom: 12px;">
            Sube un archivo Excel (.xlsx) con la siguiente estructura:
          </p>
          <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; font-size: 13px; margin-bottom: 16px;">
            <strong>Columnas requeridas:</strong> marca, modelo, embragues, frenos, suspensi√≥n, filtros y diferenciales, sistema de aire, sistema de direcci√≥n<br>
            <strong>Columna opcional:</strong> motor<br><br>
            <strong>Formato de productos:</strong> SKU123 (marca_producto)
          </div>
        </div>

        <!-- Zona de arrastrar archivo -->
        <div id="drop-zone-cruces" style="border: 2px dashed #ccc; border-radius: 8px; padding: 40px; text-align: center; background: #fafafa; cursor: pointer; transition: all 0.3s;" 
             onclick="document.getElementById('input-file-cruces').click()">
          <input type="file" id="input-file-cruces" accept=".xlsx" style="display: none;" onchange="handleFileSelect(event)">
          <div id="drop-zone-content">
            <img src="../img/Productos.svg" alt="Upload" style="width: 60px; height: 60px; opacity: 0.4; margin-bottom: 12px;">
            <p style="font-size: 16px; color: #333; margin: 0 0 8px 0;"><strong>Arrastra tu archivo Excel aqu√≠</strong></p>
            <p style="font-size: 14px; color: #666; margin: 0;">o haz click para seleccionar</p>
          </div>
        </div>

        <!-- Archivo seleccionado -->
        <div id="selected-file-info" style="display: none; margin-top: 16px; padding: 12px; background: #e8f5e9; border-radius: 6px; border-left: 3px solid #4caf50;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <span style="font-size: 24px;">üìÑ</span>
            <div style="flex: 1;">
              <strong id="file-name" style="color: #333; display: block;"></strong>
              <span id="file-size" style="font-size: 13px; color: #666;"></span>
            </div>
            <button onclick="clearFileSelection()" style="background: none; border: none; color: #BF1823; cursor: pointer; font-size: 20px; padding: 4px;">√ó</button>
          </div>
        </div>

        <!-- Resultados del procesamiento -->
        <div id="proceso-resultado" style="display: none; margin-top: 16px;"></div>
      </div>
      <div class="sc-modal-footer">
        <button class="btn-secondary" onclick="cerrarModalCrucesVehiculos()">Cancelar</button>
        <button id="btn-procesar-cruces" class="btn-primary" onclick="procesarArchivoCruces()" disabled>
          Procesar y guardar
        </button>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- MODAL VER CRUCES EN EL SISTEMA -->
  <!-- ============================================================ -->
  <div id="modal-ver-cruces-sistema" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 1200px; max-height: 90vh;">
      <div class="sc-modal-header">
        <h3>üîó Cruces en el Sistema</h3>
        <button class="btn-close-modal" onclick="cerrarModalVerCrucesSistema()">√ó</button>
      </div>
      <div class="sc-modal-body" style="max-height: calc(90vh - 180px); overflow-y: auto;">
        <div style="margin-bottom: 16px; display: flex; gap: 12px; align-items: center;">
          <div class="search-repuesto" style="flex: 1;">
            <input type="text" id="buscar-cruce" placeholder="Buscar por marca o modelo..." class="input-repuesto" oninput="filtrarCruces()">
            <button class="btn-search-repuesto" onclick="filtrarCruces()">
              <img src="../img/Buscar.svg" alt="Buscar">
            </button>
          </div>
          <span id="contador-cruces" style="color: #666; font-size: 14px; white-space: nowrap;"></span>
        </div>

        <div id="lista-cruces-sistema" style="display: grid; gap: 16px;">
          <!-- Los cruces se cargar√°n aqu√≠ din√°micamente -->
        </div>

        <div id="sin-cruces-mensaje" style="display: none; text-align: center; padding: 60px 20px; color: #999;">
          <img src="../img/Productos.svg" alt="Sin cruces" style="width: 80px; height: 80px; opacity: 0.3; margin-bottom: 16px;">
          <p style="font-size: 16px;">No hay cruces registrados en el sistema</p>
        </div>
      </div>
      <div class="sc-modal-footer" style="display: flex; justify-content: space-between; align-items: center;">
        <button class="btn-primary" onclick="limpiarTodosCruces()" style="background: #BF1823; display: flex; align-items: center; gap: 8px;">
          <img src="../img/Deleteblanco.svg" alt="Limpiar" style="width: 16px; height: 16px;"> Limpiar todos los cruces
        </button>
        <button class="btn-secondary" onclick="cerrarModalVerCrucesSistema()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- MODAL EDITAR CRUCE -->
  <!-- ============================================================ -->
  <div id="modal-editar-cruce" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 800px; max-height: 90vh;">
      <div class="sc-modal-header">
        <h3><img src="../img/Editar flota.svg" alt="Editar" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 8px;"> Editar Cruce de Veh√≠culo</h3>
        <button class="btn-close-modal" onclick="cerrarModalEditarCruce()">√ó</button>
      </div>
      <div class="sc-modal-body" style="max-height: calc(90vh - 220px); overflow-y: auto;">
        <input type="hidden" id="edit-cruce-index">
        
        <div class="sc-form-group">
          <label>Marca del veh√≠culo</label>
          <input type="text" id="edit-cruce-marca" class="sc-input" placeholder="Ej: Toyota">
        </div>

        <div class="sc-form-group">
          <label>Modelo del veh√≠culo</label>
          <input type="text" id="edit-cruce-modelo" class="sc-input" placeholder="Ej: Hilux 2.4">
        </div>

        <h4 style="margin: 24px 0 12px 0; color: #333;">Categor√≠as de productos</h4>
        
        <div id="edit-cruce-categorias-container">
          <!-- Las categor√≠as se cargar√°n aqu√≠ -->
        </div>

        <button class="btn-secondary" onclick="agregarCategoriaCruce()" style="margin-top: 12px; width: 100%;">
          <span style="font-size: 16px; margin-right: 4px;">+</span> Agregar categor√≠a
        </button>
      </div>
      <div class="sc-modal-footer">
        <button class="btn-secondary" onclick="cerrarModalEditarCruce()">Cancelar</button>
        <button class="btn-primary" onclick="guardarEdicionCruce()">Guardar cambios</button>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- MODAL VER PRODUCTOS GUARDADOS -->
  <!-- ============================================================ -->
  <div id="modal-ver-productos-guardados" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 1400px; max-height: 90vh;">
      <div class="sc-modal-header">
        <h3 style="display: flex; align-items: center; gap: 10px;"><img src="../img/Productos.svg" alt="Productos" style="width: 24px; height: 24px; filter: invert(100%) brightness(0.34);"> Productos Guardados en la Plataforma</h3>
        <button class="btn-close-modal" onclick="cerrarModalVerProductosGuardados()">√ó</button>
      </div>
      <div class="sc-modal-body" style="max-height: calc(90vh - 180px); overflow-y: auto;">
        <div style="margin-bottom: 16px; display: flex; gap: 12px; align-items: center;">
          <div class="search-repuesto" style="flex: 1;">
            <input type="text" id="buscar-producto-guardado" placeholder="Buscar por SKU, repuesto o marca..." class="input-repuesto" oninput="filtrarProductosGuardados()">
            <button class="btn-search-repuesto" onclick="filtrarProductosGuardados()">
              <img src="../img/Buscar.svg" alt="Buscar">
            </button>
          </div>
          <span id="contador-productos-guardados" style="color: #666; font-size: 14px; white-space: nowrap;"></span>
        </div>

        <div class="table-responsive">
          <table class="sc-table" id="tabla-productos-guardados" style="font-size: 13px;">
            <thead>
              <tr>
                <th>SKU</th>
                <th>Repuesto</th>
                <th>Marca</th>
                <th>L√≠nea</th>
                <th style="width: 60px;">Stock</th>
                <th style="width: 80px; text-align: center;">Acciones</th>
              </tr>
            </thead>
            <tbody id="tbody-productos-guardados">
              <!-- Los productos se cargar√°n aqu√≠ din√°micamente -->
            </tbody>
          </table>
        </div>

        <div id="sin-productos-mensaje" style="display: none; text-align: center; padding: 60px 20px; color: #999;">
          <img src="../img/Productos.svg" alt="Sin productos" style="width: 80px; height: 80px; opacity: 0.3; margin-bottom: 16px;">
          <p style="font-size: 16px;">No hay productos guardados en la plataforma</p>
        </div>
      </div>
      <div class="sc-modal-footer">
        <button class="btn-secondary" onclick="cerrarModalVerProductosGuardados()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- MODAL AGREGAR PRODUCTO A BD -->
  <!-- ============================================================ -->
  <!-- MODAL AGREGAR PRODUCTO A BD -->
  <!-- ============================================================ -->
  <div id="modal-agregar-producto-bd" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 1400px;">
      <div class="sc-modal-header">
        <h3><img src="../img/Signo m√°s.svg" alt="Agregar" style="width: 24px; height: 24px; filter: brightness(0) saturate(100%) invert(27%) sepia(72%) saturate(1600%) hue-rotate(340deg) brightness(100%) contrast(102%); margin-right: 8px; display: inline-block; vertical-align: middle;"> Agregar Productos a Base de Datos Global</h3>
        <button class="btn-close-modal" onclick="cerrarModalAgregarProductoBD()">√ó</button>
      </div>
      
      <div class="sc-modal-body">
        <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
            <img src="../img/info_471662-01 1.svg" alt="Info" style="width: 20px; height: 20px; filter: brightness(0) saturate(100%) invert(27%) sepia(72%) saturate(1600%) hue-rotate(340deg) brightness(100%) contrast(102%); flex-shrink: 0;">
            <h4 style="margin: 0; color: #856404;">Importante: Base de Datos Global</h4>
          </div>
          <p style="margin: 0 0 0 32px; font-size: 13px; color: #555;">
            Los productos aqu√≠ agregados se guardan en la base de datos global <strong>sin precio</strong>. 
            El precio solo se asigna al subirlos a la lista de repuestos del cliente.
          </p>
        </div>
        
        <div class="table-responsive">
          <table class="sc-table upload-table" id="tabla-productos-bd">
            <thead>
              <tr>
                <th>Cod. Cliente (Opc)</th>
                <th>Repuesto *</th>
                <th>Marca *</th>
                <th>L√≠nea (Auto)</th>
                <th>C√≥d. StarClutch *</th>
                <th>Stock</th>
                <th style="width: 220px;">Im√°genes</th>
                <th style="width: 100px; text-align: center;">Ficha T√©cnica</th>
                <th style="width: 50px;"></th>
              </tr>
            </thead>
            <tbody>
              <!-- Tabla vac√≠a inicialmente - usar bot√≥n "+ Agregar producto" para agregar filas -->
            </tbody>
          </table>
        </div>

        <div class="modal-actions-row">
            <button class="btn-text" onclick="agregarFilaBD()">
                <span style="font-size:18px; margin-right:5px;">+</span> Agregar producto
            </button>
        </div>

        <datalist id="lista-repuestos-bd">
            <option value="Kit de embrague">
            <option value="Kit de embrague + Volante">
            <option value="Volantes">
            <option value="Discos de embrague">
            <option value="Rodamiento">
            <option value="Prensa">
            <option value="Servo">
            <option value="Componente AMT.V">
            <option value="Caliper y kit">
            <option value="Pastillas de freno">
            <option value="Disco de freno">
            <option value="Tambor de freno">
            <option value="Patines">
            <option value="Balatas">
            <option value="Pulm√≥n de freno">
            <option value="Mazas">
            <option value="Freno motor">
            <option value="Chicharras">
            <option value="Pulm√≥n de suspensi√≥n">
            <option value="Pulm√≥n de levante">
            <option value="Fuelle">
            <option value="Filtro de aceite">
            <option value="Filtro de aire">
            <option value="Filtro de cabina">
            <option value="Filtro de combustible">
            <option value="Filtro separador">
            <option value="Filtro hidr√°ulico">
            <option value="V√°lvula">
            <option value="Secador">
            <option value="Compresor">
            <option value="Correa">
            <option value="Barra de direcci√≥n">
            <option value="Barra estabilizadora">
            <option value="Barra tensora">
            <option value="Barras en V">
            <option value="Terminales de direcci√≥n">
            <option value="Soporte">
        </datalist>

        <datalist id="lista-marcas-bd">
            <option value="ACE"><option value="AIRTECH"><option value="AKROL">
            <option value="ALLIANCE"><option value="AUTIMPEX"><option value="CASTERTECH">
            <option value="CRB"><option value="EATON"><option value="EXEDY">
            <option value="FAG"><option value="FERSA"><option value="FLEETGUARD">
            <option value="FLYTECH"><option value="FRASLE"><option value="HTECH">
            <option value="JOST"><option value="KNORR BREMSE"><option value="LEMFORDER">
            <option value="LUK"><option value="MASTER"><option value="MERITOR">
            <option value="SAB"><option value="SACHS"><option value="SUSPENSYS">
            <option value="VALEO"><option value="WABCO">
        </datalist>

      </div>

      <div class="sc-modal-footer">
        <button class="btn-secondary" onclick="cerrarModalAgregarProductoBD()">Cancelar</button>
        <button class="btn-primary" onclick="guardarProductosBD()">Guardar productos</button>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- MODAL EDITAR PRODUCTO GUARDADO -->
  <!-- ============================================================ -->
  <div id="modal-editar-producto-guardado" class="sc-modal-overlay">
    <div class="sc-modal-container" style="max-width: 1000px;">
      <div class="sc-modal-header">
        <h3 style="display: flex; align-items: center; gap: 10px;"><img src="../img/Editar flota.svg" alt="Editar" style="width: 24px; height: 24px;"> Editar Producto</h3>
        <button class="btn-close-modal" onclick="cerrarModalEditarProductoGuardado()">√ó</button>
      </div>
      <div class="sc-modal-body" style="max-height: calc(90vh - 180px); overflow-y: auto; padding: 24px;">
        <input type="hidden" id="edit-producto-sku-original">
        
        <!-- Fila 1: SKU y C√≥digo Cliente -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
          <div class="sc-input-wrapper">
            <label class="sc-label" style="font-weight: 600; margin-bottom: 8px;">C√≥digo StarClutch (SKU) *</label>
            <input type="text" id="edit-producto-sku" class="sc-input-small" placeholder="Ej: KITTOY400DR" style="width: 100%;" required>
          </div>

          <div class="sc-input-wrapper">
            <label class="sc-label" style="font-weight: 600; margin-bottom: 8px;">C√≥digo Cliente (Opcional)</label>
            <input type="text" id="edit-producto-cod-cliente" class="sc-input-small" placeholder="C√≥digo interno del cliente" style="width: 100%;">
          </div>
        </div>

        <!-- Fila 2: Repuesto y Marca -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 32px;">
          <div class="sc-input-wrapper">
            <label class="sc-label" style="font-weight: 600; margin-bottom: 8px;">Repuesto *</label>
            <input list="lista-repuestos-editar" type="text" id="edit-producto-repuesto" class="sc-input-small input-repuesto" placeholder="Escribe..." style="width: 100%;" required>
          </div>

          <div class="sc-input-wrapper">
            <label class="sc-label" style="font-weight: 600; margin-bottom: 8px;">Marca *</label>
            <input list="lista-marcas-editar" type="text" id="edit-producto-marca" class="sc-input-small input-repuesto" placeholder="Escribe..." style="width: 100%;" required>
          </div>
        </div>

        <!-- Fila 3: L√≠nea y Stock -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 32px;">
          <div class="sc-input-wrapper">
            <label class="sc-label" style="font-weight: 600; margin-bottom: 8px;">L√≠nea *</label>
            <input list="lista-lineas-editar" type="text" id="edit-producto-linea" class="sc-input-small input-repuesto" placeholder="Ej: Liviano, Pesado" style="width: 100%;" required>
          </div>

          <div class="sc-input-wrapper">
            <label class="sc-label" style="font-weight: 600; margin-bottom: 8px;">Stock *</label>
            <input type="number" id="edit-producto-stock" class="sc-input-small" placeholder="0" min="0" style="width: 100%;" required>
          </div>
        </div>

        <!-- Separador visual -->
        <hr style="border: none; border-top: 1px solid #e0e0e0; margin: 24px 0;">

        <!-- Fila 4: Ficha T√©cnica (ancho completo) -->
        <div class="sc-input-wrapper" style="margin-bottom: 24px;">
          <label class="sc-label" style="font-weight: 600; margin-bottom: 8px;">Ficha T√©cnica</label>
          <textarea id="edit-producto-ficha" class="sc-input-small" rows="3" placeholder="Especificaciones t√©cnicas del producto..." style="width: 100%; font-family: 'Poppins', sans-serif; padding: 10px; border-radius: 6px; border: 1px solid #ddd; resize: vertical;"></textarea>
        </div>

        <!-- Fila 5: Referencia Cruzada (ancho completo) -->
        <div class="sc-input-wrapper" style="margin-bottom: 24px;">
          <label class="sc-label" style="font-weight: 600; margin-bottom: 8px;">Referencia Cruzada</label>
          <textarea id="edit-producto-referencia" class="sc-input-small" rows="2" placeholder="Referencias cruzadas con otros c√≥digos..." style="width: 100%; font-family: 'Poppins', sans-serif; padding: 10px; border-radius: 6px; border: 1px solid #ddd; resize: vertical;"></textarea>
        </div>

        <!-- Fila 6: OEM (ancho completo) -->
        <div class="sc-input-wrapper">
          <label class="sc-label" style="font-weight: 600; margin-bottom: 8px;">OEM</label>
          <textarea id="edit-producto-oem" class="sc-input-small" rows="2" placeholder="C√≥digos OEM..." style="width: 100%; font-family: 'Poppins', sans-serif; padding: 10px; border-radius: 6px; border: 1px solid #ddd; resize: vertical;"></textarea>
        </div>
      </div>
      <div class="sc-modal-footer">
        <button class="btn-secondary" onclick="cerrarModalEditarProductoGuardado()">Cancelar</button>
        <button class="btn-primary" onclick="guardarEdicionProductoGuardado()">Guardar cambios</button>
      </div>
    </div>

    <!-- Datalists para el modal de editar producto -->
    <datalist id="lista-repuestos-editar">
      <option value="Kit de embrague">
      <option value="Kit de embrague + Volante">
      <option value="Volantes">
      <option value="Discos de embrague">
      <option value="Rodamiento">
      <option value="Prensa">
      <option value="Servo">
      <option value="Componente AMT.V">
      <option value="Caliper y kit">
      <option value="Pastillas de freno">
      <option value="Disco de freno">
      <option value="Tambor de freno">
      <option value="Patines">
      <option value="Balatas">
      <option value="Pulm√≥n de freno">
      <option value="Mazas">
      <option value="Freno motor">
      <option value="Chicharras">
      <option value="Pulm√≥n de suspensi√≥n">
      <option value="Pulm√≥n de levante">
      <option value="Fuelle">
      <option value="Filtro de aceite">
      <option value="Filtro de aire">
      <option value="Filtro de cabina">
      <option value="Filtro de combustible">
      <option value="Filtro separador">
      <option value="Filtro hidr√°ulico">
      <option value="V√°lvula">
      <option value="Secador">
      <option value="Compresor">
      <option value="Correa">
      <option value="Barra de direcci√≥n">
      <option value="Barra estabilizadora">
      <option value="Barra tensora">
      <option value="Barras en V">
      <option value="Terminales de direcci√≥n">
      <option value="Soporte">
    </datalist>

    <datalist id="lista-marcas-editar">
    </datalist>

    <datalist id="lista-lineas-editar">
      <option value="Liviano">
      <option value="Pesado">
      <option value="Medio">
    </datalist>
  </div>

  <!-- Librer√≠a XLSX para lectura de Excel -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script src="../script.js"></script>
  <script src="../productos_guardados.js"></script>
  
</body>
</html>